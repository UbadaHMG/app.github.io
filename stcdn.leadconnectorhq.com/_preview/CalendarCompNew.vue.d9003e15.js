import{d as G,I as H,u as M,M as K,c as h,E as Q,G as J,H as p,o as V,a as b,b as X,f as i,h as x,P as Z}from"./entry.0e8f1b40.js";import{E as Y,o as W,n as ee}from"./constants.c1fa6fa6.js";import{_ as ae}from"./CalendarComponent.540411c1.js";import{_ as te}from"./CalendarComponentv3.vue.8550499c.js";import{W as R}from"./HLConst.96411594.js";import{i as O}from"./utils.06d161ac.js";import{s as re}from"./index.35670e06.js";import{i as se,x as U,y as ne,u as L,v as C,s as j}from"./calendar_helper.002810c5.js";import{s as oe}from"./am_helper.703cc0d7.js";import{i as le}from"./FormComponent.vue.ab26e6f7.js";const ke=G({__name:"CalendarCompNew",props:["shouldUseSlug","calendarData","calendarElementClass","redirect","funnelPreview","oneTimeSlug"],emits:["on-submit"],async setup(v,{emit:A}){var q;let D,_;const y=v;H(),M({script:[{src:R.IFRAME_RESIZE,async:!0,type:"text/javascript"},{src:R.IFRAME_PIXEL,async:!0,type:"text/javascript"}]});const l=K({urlParams:void 0,url:void 0,referrer:void 0,directWidget:!0,stickyContactData:void 0,stickyContactFingerprint:void 0}),E=h(()=>{var s,r;if(!((s=o.value)!=null&&s.calendarData))throw p({statusCode:404,statusMessage:"Page Not Found"});const e={services:[],calendarProvider:{},eventId:void 0,calendarEvent:void 0},n=Object.keys(o.value.calendarData),a=o.value.calendarData[n[0]];if(e.services.push(a.calendar),(a==null?void 0:a.widget_type)==="classic")return a;if(e.calendarProvider=((r=a.provider)==null?void 0:r._data)||{},e.calendarProvider.startDayOfWeek=a.calendar.startDayOfWeek,e.calendarProvider.country=a.calendar.country,e.calendarProvider.timezone=a.calendar.timezone,e.calendarProvider.use24hFormat=a.calendar.use24hFormat,e.calendarProvider.language=a.calendar.language,e.calendarProvider.disableContactTimezone=a.calendar.disableContactTimezone,t.query.event_id&&(e.eventId=t.query.event_id,e.calendarEvent=a.calendar.calendarEvent,!(e!=null&&e.calendarEvent)))throw p({statusCode:404,statusMessage:"Failed to get event details"});return e}),$=()=>{var r;let e;const n=(r=E.value)==null?void 0:r.services[0];let a=n==null?void 0:n.widget_config;if(a&&(e={...a==null?void 0:a.primarySettings,default:a==null?void 0:a.default}),Object.keys(t.query).length!==0){const c=U(t.query);c&&(e=c)}const s=(e==null?void 0:e.default)===!0||(e==null?void 0:e.default)==="true";if(e&&!s){const c=ne(e==null?void 0:e.backgroundColor);let u=L(c?g.value?C.DARK:C.DARK_OLD:g.value?C.LIGHT:C.LIGHT_OLD);return g.value&&((e==null?void 0:e.primaryColor.length)===9&&(u.lightPrimaryColor=(e==null?void 0:e.primaryColor.substring(0,(e==null?void 0:e.primaryColor.length)-2))+"12"),(e==null?void 0:e.backgroundColor.length)===7&&(u.blurColor=(e==null?void 0:e.backgroundColor)+"b3"),(e==null?void 0:e.backgroundColor.length)===9&&(u.blurColor=(e==null?void 0:e.backgroundColor.substring(0,(e==null?void 0:e.backgroundColor.length)-2))+"b3")),u.primaryColor=e==null?void 0:e.primaryColor,u.backgroundColor=e==null?void 0:e.backgroundColor,j(u,void 0,g.value,!1)}else{let c=L(g.value?C.DEFAULT:C.DEFAULT_OLD);return j(c,void 0,g.value,!1)}},N=h(()=>{const e=$();return`:root { ${Object.entries(e).map(([n,a])=>`${n}: ${a} !important;`).join("")} }`}),t=Q();let P=t.query.notrack;const I=()=>{A("on-submit")},B=Z(),{data:o}=([D,_]=J(async()=>ee(y.calendarElementClass||"calendarData",async e=>{var n;if(y.calendarData)return{calendarData:y.calendarData,notrack:!1,lang:"en"};try{let a=t.params.slug||t.params.oneTimeSlug;if(a&&a[0]==="/"&&(a=a.substring(1)),!a&&!t.params.id&&!t.query.calendar)throw p({statusCode:404,statusMessage:"Calendar Id not found"});let s=B.public.newBaseURL,r,c=`/appointment/widget?${y.shouldUseSlug?"slug":"calendarId"}=${y.shouldUseSlug?a:t.params.id||t.query.calendar}&event_id=${t.query.event_id||""}`;y.oneTimeSlug&&(c=`/appointment/widget?oneTimeSlug=${t.params.oneTimeSlug}`);try{r=await $fetch(s+c)}catch(m){throw(m==null?void 0:m.status)===404&&((n=m==null?void 0:m.data)==null?void 0:n.oneTimeSlug)==="expired"?p({statusCode:404,statusMessage:"Slug Expired",fatal:!0,message:"Uh-oh! The link is no longer active. Please reach out to the event owner for a new link"}):p({statusCode:404,statusMessage:"Page Not Found"})}let u,w,f;if(t.query.lang)u=t.query.lang;else if(r&&Object.keys(r).length>0){const m=r[Object.keys(r)[0]],d=m==null?void 0:m.calendar;d&&(d!=null&&d.language&&(u=d==null?void 0:d.language),w=d==null?void 0:d.calendarEvent,f=d)}const z=se({start_time:w==null?void 0:w.start_time,selected_timezone:f==null?void 0:f.timezone},f==null?void 0:f.reschedule_preference);if(w&&z)throw p({statusCode:404,statusMessage:"Reschedule Link expired",fatal:!0,message:"Reschedules are not allowed at this time. Please contact us for assistance."});return{calendarData:r,notrack:t.query.notrack,lang:u}}catch(a){return{error:a}}},"$VEBQuB9jFJ")),D=await D,_(),D);if(o.value&&((q=o.value)!=null&&q.error))throw p(o.value.error);const S=h(()=>{var r;if(!((r=o.value)!=null&&r.calendarData))throw p({statusCode:404,statusMessage:"Page Not Found"});const e=Object.keys(o.value.calendarData),n=o.value.calendarData[e[0]];return U(t.query)?"default":t.query.widget_type||n.calendar.widget_type}),g=h(()=>{var a,s,r;if(!((a=o.value)!=null&&a.calendarData))throw p({statusCode:404,statusMessage:"Page Not Found"});const e=Object.keys(o.value.calendarData),n=o.value.calendarData[e[0]];return(r=(s=n==null?void 0:n.calendar)==null?void 0:s.feature_flags)==null?void 0:r.revampedWidgetDesign});o.value&&S.value!=="classic"&&M(()=>({style:[{children:N.value,type:"text/css"}]}));const k=h(()=>{var e;if(!((e=o.value)!=null&&e.calendarData))throw p({statusCode:404,statusMessage:"Page Not Found"});return O(o.value.calendarData)?[]:Object.values(o.value.calendarData).map(n=>n.calendar)}),T=h(()=>{if(t.params.oneTimeSlug&&!O(o.value.calendarData))return Object.keys(o.value.calendarData)[0]});V(async()=>{await re();{const e=T.value||t.params.slug||t.query.calendar||t.params.id;if(e){const n=k.value.findIndex(s=>s.id===e&&e.split(",")[0]);let a;n>-1?a=k.value[n]:a=k.value[0],window.parent.postMessage(["fetch-query-params",window.name||"",a.location_id],"*"),window.parent.postMessage(["fetch-sticky-contacts",a.location_id],"*"),P=le(t.query),P||(Y()?window.onmessage=s=>{s.data[0]=="query-params"?(F(s.data[2],s.data[3]),l.urlParams=s.data[1],l.url=s.data[2],l.referrer=s.data[3]):s.data[0]=="sticky-contacts"&&(l.stickyContactData=s.data[1],l.stickyContactFingerprint=s.data[2])}:(t.query.am_id&&oe(a.location_id,a.id,t.query.am_id),F()))}}l.directWidget=!window||window.self===window.top});function F(e,n){const a=T.value||t.params.slug||t.query.id||t.params.id;if(a&&!y.funnelPreview){const s=k.value.findIndex(c=>c.id===a&&a.split(",")[0]);let r;s>-1?r=k.value[s]:r=k.value[0],W(r.location_id,"calendar",r.id,r.name,e,n),window.attribution={locationId:r.location_id,parentId:r.id,parentName:r.name,type:"calendar"}}}return(e,n)=>(b(),X("div",null,[i(S)==="classic"?(b(),x(ae,{key:0,"calendar-data":i(o).calendarData,pageUrl:i(l).url,urlParams:i(l).urlParams,baseReferrrer:i(l).referrer,stickyContactData:i(l).stickyContactData,stickyContactFingerprint:i(l).stickyContactFingerprint,calendarElementClass:v.calendarElementClass,redirect:v.redirect,"funnel-preview":v.funnelPreview,onOnSubmit:I},null,8,["calendar-data","pageUrl","urlParams","baseReferrrer","stickyContactData","stickyContactFingerprint","calendarElementClass","redirect","funnel-preview"])):(b(),x(te,{key:1,calendarData:i(E),directWidget:i(l).directWidget,pageUrl:i(l).url,urlParams:i(l).urlParams,baseReferrrer:i(l).referrer,stickyContactData:i(l).stickyContactData,stickyContactFingerprint:i(l).stickyContactFingerprint,calendarElementClass:v.calendarElementClass,redirect:v.redirect,"funnel-preview":v.funnelPreview,onOnSubmit:I},null,8,["calendarData","directWidget","pageUrl","urlParams","baseReferrrer","stickyContactData","stickyContactFingerprint","calendarElementClass","redirect","funnel-preview"]))]))}});export{ke as _};
