import{d as D,r as d,J as N,o as R,g as H,a as u,b as _,e as v,n as F,a6 as J,_ as Y,c as i,$ as G,f as s,t as U,i as f,h as V,w as X,v as Z,F as ee,P as te,U as ae,V as ne}from"./entry.0e8f1b40.js";import{Q as se}from"./ghl-payment-element.es.49018b09.js";import{P as re,e as oe}from"./calendar_helper.002810c5.js";import{C as ie}from"./localeData.865a95fc.js";import{E as ce}from"./constants.c1fa6fa6.js";const le=J('<div class="item" data-v-1a7d452a><svg width="66" height="66" viewBox="0 0 66 66" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-1a7d452a><rect x="5" y="5" width="56" height="56" rx="28" fill="#FEE4E2" data-v-1a7d452a></rect><rect x="5" y="5" width="56" height="56" rx="28" stroke="#FEF3F2" stroke-width="10" data-v-1a7d452a></rect><path d="M31.2497 24.9988C31.8225 24.8895 32.4082 24.8333 32.9997 24.8333C35.475 24.8333 37.849 25.8167 39.5993 27.567C41.3497 29.3173 42.333 31.6913 42.333 34.1667C42.333 34.7582 42.2769 35.3439 42.1675 35.9167M40.1578 40.156C39.9815 40.3668 39.7952 40.5705 39.5993 40.7663C37.849 42.5167 35.475 43.5 32.9997 43.5C30.5243 43.5 28.1504 42.5167 26.4 40.7663C24.6497 39.016 23.6663 36.642 23.6663 34.1667C23.6663 31.6913 24.6497 29.3173 26.4 27.567C26.5941 27.373 26.7958 27.1883 27.0044 27.0134M23.6663 23.6667L21.333 26M44.6663 26L41.1663 22.5M25.9997 41.1667L23.6663 43.5M43.4997 43.5L22.4997 22.5" stroke="#D92D20" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-1a7d452a></path></svg></div><div class="item" data-v-1a7d452a><p class="session-expired-text" data-v-1a7d452a>Session Expired</p><span class="session-expired-sub-text" data-v-1a7d452a>Uh-oh! Your session has timed out.</span><span class="session-expired-sub-text" data-v-1a7d452a>Please start over to initiate a new booking</span></div>',2),de=D({__name:"SessionExpireComponent",props:{expireTime:{type:Number,required:!0,default:0},state:{type:Object,required:!0}},emits:["handleStartOver"],setup(n,{emit:h}){const r=n,t=d(0);let c=null;N(()=>r.state.paymentStatus,()=>{r.state.paymentStatus===re.COMPLETED&&l()}),N(()=>r.state.isPaymentWindowExpire,async()=>{r.state.isPaymentWindowExpire&&ie.appointmentBookingLogs(r.state.traceId,{eventId:r.state.appointmentId,message:"payment session expired after 10 minutes"})}),R(()=>{t.value=new Date().getTime()+r.expireTime*1e3,m()});const m=()=>{r.expireTime,c=setInterval(()=>{new Date().getTime()<=t.value||(l(),P())},1e3)},l=()=>{c&&(clearInterval(c),c=null)},C=()=>{h("handleStartOver",{restartBooking:!0})},P=()=>{r.state.isPaymentWindowExpire=!0};return H(()=>{l()}),(x,S)=>(u(),_("div",{class:F(["container",{"session-container-min-height":!n.state.isMobileVersion}])},[v("div",{class:"cal-col"},[le,v("div",{class:"item"},[v("button",{class:"btn start-over-btn",onClick:C,id:"reset-calendar-button"}," Start Over ")])])],2))}});const ue=Y(de,[["__scopeId","data-v-1a7d452a"]]),me=n=>(ae("data-v-95e0d5af"),n=n(),ne(),n),pe={class:"payment-info-section"},ve=me(()=>v("span",{class:"payment-info"},"Payment information",-1)),ye={class:"payment-service-amount"},fe={key:0,class:"error"},_e={key:1,class:"cal-payment-element"},ge=D({__name:"CalendarPaymentPage",props:{state:{type:Object,required:!0},showSessionExpire:{type:Boolean,default:!1}},emits:["onPaymentCallback","handleBackClick","update-state"],setup(n,{expose:h,emit:r}){var I,M,T,O;const t=n,c=te(),m=d(),l=d(),C=d(c.public.NODE_ENV==="dev"?"staging":c.public.NODE_ENV),P=i(()=>{const e=ce()&&t.state.pageUrl?new URL(t.state.pageUrl):window.location;return`${e.origin}${e.pathname}${e.hash}`}),x=i(()=>{var e,a;return!((a=(e=t.state)==null?void 0:e.calendar)!=null&&a.form_id)}),S=i(()=>{const e="payment-card-container",a=t.state.isMobileVersion;return t.state.isFormFirst?[e,{"payment-element-spacing-mobile":a}]:x.value?["default-form-spacing",{"default-form-spacing-mobile":a}]:["payment-card-container-in-form"]}),w=i(()=>{var e;return((e=t.state.calendar)==null?void 0:e.is_live_payment_mode)||!1}),b=d(w.value?c.public.STRIPE_PMC_KEY_LIVE:c.public.STRIPE_PMC_KEY_TEST),k=i(()=>{var e;return((e=t.state.recurringSlots.filter(a=>!a.isUnavailable))==null?void 0:e.length)||1}),p=i(()=>{var a;const e=(a=t.state.calendar)==null?void 0:a.stripe;return e&&Number(oe(t.state.isRecurring,k.value,e))||0}),g=i(()=>{var e,a,o;return((o=(a=(e=t.state.calendar)==null?void 0:e.stripe)==null?void 0:a.currency)==null?void 0:o.toUpperCase())||"USD"}),E=i(()=>p.value===0),$=d(E.value?{currency:g.value.toLowerCase(),paymentMethodConfiguration:b.value}:{mode:"payment",amount:p.value,currency:g.value.toLowerCase(),paymentMethodConfiguration:b.value}),q=i(()=>{var e;return(e=t.state.calendar)==null?void 0:e.location_id}),j=i(()=>p.value>=0),W=d({mode:"payment",amount:p.value,currency:g.value.toLowerCase(),contact:{id:((I=t.state.contact)==null?void 0:I.id)||"",full_name:((M=t.state.contact)==null?void 0:M.full_name)||"",email:((T=t.state.contact)==null?void 0:T.email)||"",phone:((O=t.state.contact)==null?void 0:O.phone)||""}});R(()=>{var a,o;t.state.showLoadingScreen=!0;const e=((o=(a=t.state.calendar)==null?void 0:a.stripe)==null?void 0:o.paymentProvider)==="square"?3e3:2e3;setTimeout(()=>{t.state.showLoadingScreen=!1},e)}),G(()=>{var e,a;((a=(e=t.state.calendar)==null?void 0:e.stripe)==null?void 0:a.paymentProvider)==="square"&&delete window.Square});const A=["Your card number is invalid.","Your card number is incomplete.","Your card's expiry year is in the past.","Your card's expiry date is incomplete.","Your card's security code is incomplete."],K=e=>{e.amount=p.value,e.type==="error"&&(console.error("Payment error",e),A.includes(e.message)||(l.value=e.message)),r("onPaymentCallback",e)};async function z(){return await m.value.validatePayment()}async function Q(){var o,y,L,B;if(!await m.value.validatePayment())return;l.value=void 0,t.state.isPaymentProcessing=!0,t.state.showLoadingScreen=!0,t.state.startSessionExpireTimer=!0;const a={source:E.value?"update_payment_method":"calendar",contactId:(o=t.state.contact)==null?void 0:o.id,liveMode:w.value,calendarId:t.state.calendar.id,sourceId:t.state.calendar.id,extra:{contactId:(y=t.state.contact)==null?void 0:y.id,currency:g.value,amount:p.value,description:((B=(L=t.state.calendar)==null?void 0:L.stripe)==null?void 0:B.charge_description)||`Payment for calendar ${t.state.calendar.name}(Id: ${t.state.calendar.id})`,sourceName:t.state.calendar.name,appointmentId:t.state.appointmentId||t.state.recurrenceId}};await m.value.confirmPayment(a)}return h({processPayment:Q,validatePayment:z}),(e,a)=>{var o,y;return u(),_(ee,null,[n.state.isPaymentWindowExpire?f("",!0):(u(),_("div",{key:0,class:F(s(S))},[v("div",pe,[ve,v("span",ye,U((y=(o=t.state.calendar)==null?void 0:o.stripe)==null?void 0:y.charge_description),1)]),s(l)?(u(),_("div",fe,U(s(l)),1)):f("",!0),!n.state.isRecurring||s(k)>0?(u(),_("div",_e,[s(j)?(u(),V(s(se),{key:0,ref_key:"paymentElementRef",ref:m,env:s(C),id:"payment-element",altId:s(q),altType:"location",liveMode:s(w),debug:!0,callbackUrl:s(P),customProviderProps:s(W),stripeOptions:s($),"update-payment-method":s(E),onPaymentCallback:K},null,8,["env","altId","liveMode","callbackUrl","customProviderProps","stripeOptions","update-payment-method"])):f("",!0)])):f("",!0)],2)),n.showSessionExpire?X((u(),V(ue,{key:1,id:"calendar-payment-page-session-expire",state:n.state,"expire-time":n.state.paymentSessionTimeoutSeconds,onHandleStartOver:a[0]||(a[0]=()=>{r("handleBackClick")})},null,8,["state","expire-time"])),[[Z,n.state.isPaymentWindowExpire]]):f("",!0)],64)}}});const he=Y(ge,[["__scopeId","data-v-95e0d5af"]]),Se=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"}));export{he as C,ue as S,Se as a};
